/*! Remix v2.1.0 (https://github.com/shingchi/Remix) | by shingchi <shingchi@sina.cn> 2015-01-07 | Licensed under MIT */ 
!function(e,t){"use strict";var n,o,s,r=[],a=".remix",l=e.remix;o={dom:{getAll:function(){var t,n,o;return 1===arguments.length?(t=e.document.documentElement,n=arguments[0]):(t=arguments[0],n=arguments[1]),t&&t.querySelectorAll&&(o=t.querySelectorAll(n)),o},get:function(){var e=this.getAll.apply(this,arguments);return e&&e.length&&(e=e[e.length-1]),e},getData:function(t,n){var o,s=e.navigator.userAgent;return o=/msie/i.test(s)?t.getAttribute("data-"+n):t.dataset[n]},setData:function(t,n,o){var s=e.navigator.userAgent;/msie/i.test(s)?t.setAttribute("data-"+n,o):t.dataset[n]=o}},css:{has:function(e,n){var o=new RegExp("(^|\\s)"+n+"(\\s|$)");return e.className!==t?o.test(e.className):!1},add:function(e,t){return e&&t&&!this.has(e,t)?void(e.className=(e.className?e.className+" ":"")+t):!1},remove:function(e,t){var n;return e&&t&&this.has(e,t)?(n=new RegExp("( "+t+")|("+t+")","g"),void(e.className=e.className.replace(n,""))):!1},toggle:function(e,t){var n,o;n=this.has(e,t),o=n?this.remove:this.add,o.apply(this,[e,t])},swap:function(e,t,n){var o={className:e.className};this.remove(o,t),this.add(o,n),e.className=o.className}},events:{add:function(t,n,o){var s={detach:function(){return remove(t,n,o)}};return e.addEventListener?t.addEventListener(n,o,!1):t.attachEvent("on"+n,o),s},remove:e.removeEventListener!==t?function(e,t,n){return e.removeEventListener(t,n,!1)}:function(e,t,n){return e.detachEvent("on"+t,n)}}},s={req:function(e){var t,n={method:e.type||"GET",url:((e.url||location.href)+"").replace("/#.*$/","").replace("/^///",location.protocol+"//"),data:e.data||null,dataType:e.dataType||"json",async:e.async||!0,callback:e.callback||new Function};t=this.xhr.call(this),n.data&&(n.url=this.setUrl(n.url,n.data)),t.open(n.method,n.url,n.async),t.setRequestHeader("Content-Type","charset=UTF-8"),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Remix-Hash",l.hash),t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){var e="json"!=n.dataType?t.responseText:JSON.parse(t.responseText);n.callback.call(this,e)}else console.error("Bad Request: "+t.statusText)};try{t.send()}catch(o){}},xhr:function(){try{return new XMLHttpRequest}catch(e){}},setUrl:function(e,t){var n,o=[];for(var s in t)o.push(s+"="+t[s]);return n=o.join("&"),e+(/\?/.test(e)?"&":"?")+n}},n=function(n){function r(){function e(){return h.sources}function n(n){var o,s;return null===h.selectedIndex?n:(o=e(),n=n!==t?n:h.selectedIndex,s=o[n])}function s(){var e,t=h.sources.length;return null!==h.selectedIndex&&h.selectedIndex++,t>1?h.selectedIndex>=t?1==h.loop?(e=n(0),h.selectedIndex=0):(e=n(h.selectedIndex),h.selectedIndex--):e=n(h.selectedIndex):1==h.loop?(e=n(0),h.selectedIndex=0):(e=n(h.selectedIndex),h.selectedIndex=0),e}function r(){return h.selectedIndex--,h.selectedIndex<0&&(1==h.loop?h.selectedIndex=h.sources.length-1:h.selectedIndex++),n()}function a(){var e,t="."+f.selected;if(null!==h.sources&&(e=o.dom.getAll(g.playlist,t)),e)for(var n=0;n<e.length;n++)o.css.remove(e[n],f.selected)}function l(e){var n;if(a(),e!==t&&null!==e){n=o.dom.getAll(g.playlist,"li");for(var s=0;s<n.length;s++)if(e==s){o.css.add(n[s],f.selected);break}}h.selectedIndex=e}function i(){var e,t;return e=n(),e&&(t=e.src),t}return{getNext:s,getPrevious:r,getSource:n,select:l,getURL:i}}function a(e){var t=Math.floor(e/1e3),n=Math.floor(t/60),o=Math.floor(t%60);return(10>n?"0":"")+n+":"+(10>o?"0":"")+o}function i(e){var t;t=h.sources,g.controls.detail.innerHTML=t[e].title+" - "+t[e].author}function c(){h.sources.length>1&&o.css.add(g.playlist,f.menu)}function u(e){var t=soundManager.createSound({url:e,whileplaying:function(){var e;e=Math.min(100,Math.max(0,100*this.position/this.durationEstimate))+"%",this.duration&&(g.controls.progress.played.style.width=e,g.controls.duration.innerHTML="-"+a(this.duration-this.position))},onbufferchange:function(e){e?o.css.add(g.player,"buffering"):o.css.remove(g.player,"buffering")},onplay:function(){o.css.swap(g.controls.button.play,"paused","playing")},onpause:function(){o.css.swap(g.controls.button.play,"playing","paused")},onresume:function(){o.css.swap(g.controls.button.play,"paused","playing")},whileloading:function(){var e=this.bytesLoaded/this.bytesTotal*100+"%";g.controls.progress.loaded.style.width=e,this.isHTML5||(g.controls.duration.innerHTML=a(this.durationEstimate))},onload:function(e){e?g.controls.duration.innerHTML=a(this.duration):this._iO&&this._iO.onerror&&this._iO.onerror()},onerror:function(){var e;e=x.getSource(),e&&(g.controls.detail.innerHTML="错误: 当前歌曲无法播放"),o.css.swap(g.controls.button.play,"playing","paused")},onstop:function(){o.css.remove(g.controls.button.play,"playing")},onfinish:function(){var e;o.css.remove(g.controls.button.play,"playing"),g.controls.progress.played.style.width=0,g.controls.duration.innerHTML="00:00",e=x.getNext(),x.select(h.selectedIndex),i(h.selectedIndex),e&&this.play({url:e.src})}});return t}function d(e){var t=h.sources[e];soundManager.canPlayURL(t.src)&&(b||(b=u(t.src)),b.stop(),x.select(e),i(e),b.play({url:t.src,position:0}))}function p(n){if(!(t==n||null==n||n.length<1)){h.sources=n,h.auto=o.dom.getData(g.player,"auto"),h.loop=o.dom.getData(g.player,"loop");for(var s=0;s<n.length;s++){var a=e.document.createElement("li");a.innerHTML=n[s].title+" - "+n[s].author,o.dom.setData(a,"index",s),g.playlist.appendChild(a)}x=new r,x.select(0),1==h.auto&&d(0),i(0),c(),o.events.add(g.player,"click",v.handleClick),o.events.add(g.controls.progress.track,"click",v.handleShuffle)}}function m(){n||console.warn("Could not find any elements of player!"),g.player=n,g.playlist=o.dom.get(g.player,y.playlist),g.controls.main=o.dom.get(g.player,y.controls.main),g.controls.progress.track=o.dom.get(g.controls.main,y.controls.progress.track),g.controls.progress.loaded=o.dom.get(g.controls.main,y.controls.progress.loaded),g.controls.progress.played=o.dom.get(g.controls.main,y.controls.progress.played),g.controls.button.play=o.dom.get(g.controls.main,y.controls.button.play),g.controls.button.volume=o.dom.get(g.controls.main,y.controls.button.volume),g.controls.button.menu=o.dom.get(g.controls.main,y.controls.button.menu),g.controls.duration=o.dom.get(g.controls.main,y.controls.duration),g.controls.detail=o.dom.get(g.controls.main,y.controls.detail),e.navigator.userAgent.match(/mobile/i)&&o.css.add(g.player,f.noVolume);var t=o.dom.getData(g.player,"songs"),r=o.dom.getData(g.player,"type"),a=o.dom.getData(g.player,"serve");s.req({url:l.url,data:{serve:a,"do":r,id:t},callback:p})}var g,f,h,y,v,x,b;y={playlist:".remix-playlist",controls:{main:".remix-controls",progress:{track:".remix-progress",loaded:".remix-progress-loaded",played:".remix-progress-played"},button:{play:".remix-button-play",volume:".remix-button-volume",menu:".remix-button-menu"},duration:".remix-duration",detail:".remix-detail"}},f={disabled:"disabled",selected:"selected",active:"active",noVolume:"no-volume",mute:"mute",menu:"open"},g={player:null,playlist:null,controls:{main:null,progress:{track:null,loaded:null,played:null},button:{play:null,volume:null,menu:null},duration:null,detail:null}},h={auto:!1,loop:!0,selectedIndex:0,sources:null},m(),v={handleClick:function(t){var n,s,r,a,l,i;if(n=t||e.event,s=n.target||n.srcElement,s&&s.nodeName&&(r=s.nodeName.toLowerCase(),"li"===r&&(a=o.dom.getData(s,"index"),l=h.sources[a].src,h.selectedIndex===a?(b||(b=u(l)),b.togglePause()):soundManager.canPlayURL(l)&&d(a),i=!0),"i"===r)){var c=new RegExp("remix-button-play"),p=new RegExp("remix-button-volume"),m=new RegExp("remix-button-menu");c.test(s.className)&&(a=h.selectedIndex,l=h.sources[a].src,b||(b=u(l)),x.select(a),b.togglePause(),i=!0),p.test(s.className)&&(b&&(b.toggleMute(),o.css.toggle(g.controls.button.volume,f.mute)),i=!0),m.test(s.className)&&(o.css.toggle(g.playlist,f.menu),i=!0)}return i?void 0:!1},handleShuffle:function(e){function t(e){var t=0;if(e.offsetParent)for(;e.offsetParent;)t+=e.offsetLeft,e=e.offsetParent;else e.x&&(t+=e.x);return t}var n,o,s,r,a,l;return n=g.controls.progress.track,o=t(n),s=n.offsetWidth,r=e.clientX-o,a=r/s,l=b,l&&l.duration&&(l.setPosition(l.duration*a),l._iO.whileplaying.apply(l)),!1}}},soundManager.setup({html5PollingInterval:50,flashVersion:9}),soundManager.onready(function(){var e;if(e=o.dom.getAll(a),e&&e.length)for(var t=0;t<e.length;t++)r.push(new n(e[t]))})}(this);