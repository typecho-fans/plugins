
name: "Actionsæ‰§è¡ŒååŒæ­¥æ•°æ®"

on:
  workflow_run:
    workflows:
      - "ğŸ§©æ‰‹åŠ¨æ›´æ–°ä»»æ„æ”¶å½•æ’ä»¶"
      - "å®šæ—¶æ›´æ–°GitHubæºæ’ä»¶"
      - "æ¨é€æ£€æµ‹æ”¹åŠ¨è¡¨æ ¼æ¡ç›®"
    branches:
      - "master"
    types:
      - completed

jobs:

  download-sync:
    name: "ä¸‹è½½APIå¹¶æ¨é€Gitee"
    runs-on: "ubuntu-latest"

    steps:
      - uses: actions/checkout@v4

      - name: "ZIP_CDNæ•°æ®"
        run: |
          curl -s https://api.github.com/repos/typecho-fans/plugins/contents/ZIP_CDN > ZIP_CDN.json

      - name: "æ–‡æ¡£å˜æ›´æ—¶é—´"
        run: |
          date_testore=`curl -s "https://api.github.com/repos/typecho-fans/plugins/commits?path=TESTORE.md&page=1&per_page=1" | jq -r ".[0].commit.committer.date"`
          date_readme=`curl -s "https://api.github.com/repos/typecho-fans/plugins/commits?path=README.md&page=1&per_page=1" | jq -r ".[0].commit.committer.date"`
          if [[ $date_testore > $date_readme ]]; then
            echo $date_testore > UD_TIME.json
          else
            echo $date_readme > UD_TIME.json
          fi

      - name: "æäº¤æ–‡ä»¶æ›´æ–°"
        uses: stefanzweifel/git-auto-commit-action@v6
        with:
          commit_message: "Fetch API data & sync repo to Gitee for TeStore accelerations"

      - name: "åŒæ­¥Giteeé•œåƒ"
        uses: Yikun/hub-mirror-action@master
        with:
          src: github/typecho-fans
          dst: gitee/typecho-fans
          dst_key: ${{ secrets.SYNC_PV }}
          dst_token: ${{ secrets.GITEE_TOKEN }}
          account_type: org
          static_list: "plugins"
          force_update: true
