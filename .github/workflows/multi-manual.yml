# æ‰‹åŠ¨æ£€æµ‹å·²ç™»è®°æ’ä»¶(æ”¯æŒGiteeç­‰)å¹¶å¼ºåˆ¶æ›´æ–°zip
# è¿è¡Œï¼šActionsé¡µå·¦ä¸Šé€‰è„šæœ¬ï¼Œå³ä¾§Run workflowå¡«å†™åç‚¹ç»¿æŒ‰é’®

name: "ğŸ§©æ‰‹åŠ¨æ›´æ–°ä»»æ„æ”¶å½•æ’ä»¶"

on: 
  workflow_dispatch:
    inputs:
      repo-git:
        description: "æ’ä»¶åç§°æˆ–ç›®å½•åœ°å€ï¼Œå¤šé¡¹å¯ç”¨','å·åˆ†éš”"
        required: true
        default: "https://github.com/user/repo"

jobs:

  manual-update:
    name: "æ‰‹åŠ¨æ›´æ–°Gitæºæ’ä»¶"
    runs-on: "ubuntu-latest"

    steps:
      - uses: actions/checkout@v4

      - name: "æ‰§è¡ŒPHPè„šæœ¬"
        run: |
          php AUTO-UPDATE.php ${{ secrets.GITHUB_TOKEN }} ${{ github.event.inputs.repo-git }}

      - name: "æäº¤æ›´æ–°æ–‡ä»¶"
        uses: stefanzweifel/git-auto-commit-action@v6
        with:
          commit_message: "Force update requested plugins in TESTORE.md & README.md"

      - name: "ä¸Šä¼ æ“ä½œè®°å½•"
        uses: actions/upload-artifact@v4
        with:
          name: "updates-log"
          path: /home/runner/work/plugins/TMP/updates.log

      - name: "æ£€æµ‹å‹ç¼©æ–‡ä»¶"
        id: match-zips
        run: |
          echo A2C=$(find /home/runner/work/plugins/NEW -type f -name "[a-cA-C]*") >> $GITHUB_OUTPUT
          echo D2G=$(find /home/runner/work/plugins/NEW -type f -name "[d-gD-G]*") >> $GITHUB_OUTPUT
          echo H2L=$(find /home/runner/work/plugins/NEW -type f -name "[h-lH-L]*") >> $GITHUB_OUTPUT
          echo M2R=$(find /home/runner/work/plugins/NEW -type f -name "[m-rM-R]*") >> $GITHUB_OUTPUT
          echo S2Z=$(find /home/runner/work/plugins/NEW -type f -name "[s-zS-Z]*") >> $GITHUB_OUTPUT

      - name: "å‘å¸ƒå‹ç¼©åŒ…A-C"
        uses: svenstaro/upload-release-action@v2
        if: steps.match-zips.outputs.A2C
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: /home/runner/work/plugins/NEW/[a-cA-C]*
          tag: "plugins-A_to_C"
          overwrite: true
          file_glob: true

      - name: "å‘å¸ƒå‹ç¼©åŒ…D-G"
        uses: svenstaro/upload-release-action@v2
        if: steps.match-zips.outputs.D2G
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: /home/runner/work/plugins/NEW/[d-gD-G]*
          tag: "plugins-D_to_G"
          overwrite: true
          file_glob: true

      - name: "å‘å¸ƒå‹ç¼©åŒ…H-L"
        uses: svenstaro/upload-release-action@v2
        if: steps.match-zips.outputs.H2L
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: /home/runner/work/plugins/NEW/[h-lH-L]*
          tag: "plugins-H_to_L"
          overwrite: true
          file_glob: true

      - name: "å‘å¸ƒå‹ç¼©åŒ…M-R"
        uses: svenstaro/upload-release-action@v2
        if: steps.match-zips.outputs.M2R
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: /home/runner/work/plugins/NEW/[m-rM-R]*
          tag: "plugins-M_to_R"
          overwrite: true
          file_glob: true

      - name: "å‘å¸ƒå‹ç¼©åŒ…S-Z"
        uses: svenstaro/upload-release-action@v2
        if: steps.match-zips.outputs.S2Z
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: /home/runner/work/plugins/NEW/[s-zS-Z]*
          tag: "plugins-S_to_Z"
          overwrite: true
          file_glob: true
